window.GFDropboxSettings=null,function(a){GFDropboxSettings=function(){var b=this;this.init=function(){this.initialValues={appKey:this.getAppKey(),appSecret:this.getAppSecret()},this.pageURL=gform_dropbox_pluginsettings_strings.settings_url,this.bindAppKeyUpdate(),this.bindDeauthorize(),this.bindDisableCustomApp(),this.bindEnableCustomApp(),this.setupValidationIcons(),a("#tab_gravityformsdropbox #gform-settings-save").hide()},this.bindAppKeyUpdate=function(){a("input#customAppKey, input#customAppSecret").on("blur",this.checkAppKeyValidity)},this.bindDeauthorize=function(){a("#gform_dropbox_deauth_button").on("click",function(c){c.preventDefault(),a(this).attr("disabled","disabled"),a.ajax({async:!1,url:ajaxurl,dataType:"json",data:{action:"gfdropbox_deauthorize"},success:function(c){c.success?window.location.href=b.pageURL:alert(c.data.message),a(this).removeAttr("disabled")}})})},this.bindDisableCustomApp=function(){a("#gform_dropbox_disable_customApp").on("click",function(b){b.preventDefault(),a("input#customAppEnable").val(""),a("#gform-settings-save").trigger("click")})},this.bindEnableCustomApp=function(){a("#gform_dropbox_enable_customApp").on("click",function(b){b.preventDefault(),a("input#customAppEnable").val("1"),a("#gform-settings-save").trigger("click")})},this.checkAppKeyValidity=function(){b.lockAppKeyFields(!0),b.resetAppKeyStatus(),a.ajax({url:ajaxurl,dataType:"json",type:"GET",data:{action:"gfdropbox_valid_app_key_secret",app_key:b.getAppKey(),app_secret:b.getAppSecret()},success:function(a){b.setAppKeyStatus(a.valid_app_key,a.auth_url),b.lockAppKeyFields(!1)}})},this.getAppKey=function(){return a("input#customAppKey").val()},this.getAppSecret=function(){return a("input#customAppSecret").val()},this.lockAppKeyFields=function(b){a("input#customAppKey, input#customAppSecret").prop("disabled",b)},this.resetAppKeyStatus=function(){a("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").removeClass("icon-check icon-remove fa-check fa-times gf_valid gf_invalid")},this.setAppKeyStatus=function(c,d){!0===c&&(window.location.href=b.pageURL),!1===c&&a("#gaddon-setting-row-customAppKey .fa, #gaddon-setting-row-customAppSecret .fa").addClass("icon-remove fa-times gf_invalid"),!1!==c&&null!==c||(a("#gform_dropbox_auth_message").show(),a("#gform_dropbox_auth_button").hide())},this.setupValidationIcons=function(){0==a("#gaddon-setting-row-customAppKey .fa").length&&a(' <i class="fa"></i>').insertAfter(a("#customAppKey")),0==a("#gaddon-setting-row-customAppSecret .fa").length&&a('<i class="fa"></i>').insertAfter(a("#customAppSecret"))},this.init()},a(document).ready(GFDropboxSettings)}(jQuery);